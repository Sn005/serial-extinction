# リバイザー（修正エージェント）

**発動条件**: 「修正」「改訂」「レビュー対応」等のキーワード、または品質レビュー後

---

## 目的

品質レビュー（`/quality-reviewer`）の結果に基づき、章の修正を実施する。
修正は優先度順に行い、修正後の品質向上を確認する。

---

## 実行内容

### 1. レビュー結果の解析

`/quality-reviewer` の出力から以下を抽出：

- 優先度「高」の問題リスト
- 優先度「中」の問題リスト
- 優先度「低」の改善提案

### 2. 修正計画の策定

#### 修正の優先順位

| 優先度 | 対象 | 対応 |
|--------|------|------|
| 高 | 整合性エラー、禁止事項違反 | 必須修正 |
| 中 | 文体問題、表現の改善 | 推奨修正 |
| 低 | 軽微な改善 | 任意修正 |

#### 修正の依存関係

- 構造的な修正 → 表現の修正
- セクション削除 → 他セクションへの影響確認
- 伏線修正 → 関連章との整合確認

### 3. 修正実施

#### 修正タイプ別アプローチ

##### A. 整合性エラーの修正
- 科学的事実の訂正
- 時間スケールの修正
- 設定との矛盾解消

##### B. 文体問題の修正
- 感情語の削除・置換
- 擬人化表現の修正
- 無人称への修正

##### C. ダイナミズムの改善
- 構造的起伏の追加
- 対立構造の強化
- 虚無表現の調整

##### D. 表現の多様性改善
- 重複表現の集約
- 終結表現の分散
- 構文パターンの変化

##### E. 描写の厚み追加
- 具体的数値の追加
- 固有名詞の追加
- プロセス詳細の追加

### 4. 修正の検証

#### 修正前後の比較
- 変更箇所の明示（diff形式）
- 修正理由の記録

#### 新たな問題の検出
- 修正による副作用のチェック
- 整合性の再確認

### 5. 構造圧縮（必要な場合）

厚み追加後に文字数が大幅に増加した場合：

1. 重複分析
2. 集約先の決定
3. 重複箇所の削除
4. セクション統合の検討

---

## 出力形式

```markdown
## 修正レポート: Extinction XX

### 修正サマリー

| 優先度 | 対象数 | 修正済 | スキップ |
|--------|--------|--------|----------|
| 高 | X件 | X件 | 0件 |
| 中 | Y件 | Y件 | 0件 |
| 低 | Z件 | W件 | V件 |

**総修正数**: XX件
**文字数変化**: XX,XXX字 → YY,YYY字 (+/-ZZZ字)

---

### 修正詳細

#### 優先度: 高

##### 1. [問題タイトル] (行XX)

**問題**: [問題の詳細]

**修正前**:
```
[修正前のテキスト]
```

**修正後**:
```
[修正後のテキスト]
```

**修正理由**: [なぜこの修正が必要だったか]

---

#### 優先度: 中

##### 1. [問題タイトル] (行YY)

**問題**: [問題の詳細]

**修正前**:
```
[修正前のテキスト]
```

**修正後**:
```
[修正後のテキスト]
```

---

#### 優先度: 低（スキップした項目）

| # | 項目 | スキップ理由 |
|---|------|-------------|
| 1 | [項目] | [理由：意図的な表現のため等] |

---

### 構造圧縮（実施した場合）

#### 集約した重複
| 項目 | 元の出現数 | 集約後 | 集約先 |
|------|------------|--------|--------|
| [表現A] | 3回 | 1回 | §X |

#### 統合したセクション
- §X + §Y → 新§X

---

### 副作用チェック

| チェック項目 | 結果 |
|--------------|------|
| 整合性維持 | ✅ |
| 伏線への影響 | ✅ 影響なし |
| 文字数目標 | ✅ 範囲内 |

---

### 次のステップ

修正完了後の推奨アクション：

- [ ] `/quality-reviewer` で再レビュー（修正数が多い場合）
- [ ] `/final-checker` で最終確認（修正が軽微な場合）
```

---

## 修正ワークフロー

```
quality-reviewer結果
        │
        ▼
┌───────────────────┐
│ 優先度「高」を修正 │ ← 必須
└───────────────────┘
        │
        ▼
┌───────────────────┐
│ 優先度「中」を修正 │ ← 推奨
└───────────────────┘
        │
        ▼
┌───────────────────┐
│ 優先度「低」を検討 │ ← 任意
└───────────────────┘
        │
        ▼
┌───────────────────┐
│ 副作用チェック     │
└───────────────────┘
        │
        ▼
  修正数が多い？
    │
    ├── Yes → /quality-reviewer で再レビュー
    │
    └── No → /final-checker で最終確認
```

---

## 使用例

```
/reviser Extinction 04
```

または

```
品質レビューの結果に基づいて第4章を修正してください
```

---

## 他エージェントとの連携

- **前のステップ**: `/quality-reviewer` のレビュー結果を入力
- **次のステップ**:
  - 大幅修正の場合 → `/quality-reviewer` で再レビュー
  - 軽微修正の場合 → `/final-checker` で最終確認
